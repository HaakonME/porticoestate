var myDataSource,myDataTable,myContextMenu,tableYUI,values_ds;this.getSumPerPage=function(a,c,d,b){begin=end=0;if((d.getPageRecords()[1]-d.getPageRecords()[0]+1)==b.getRecordSet().getLength()){begin=0;end=d.getPageRecords()[1]-d.getPageRecords()[0]}else{begin=d.getPageRecords()[0];end=d.getPageRecords()[1]}tmp_sum=0;for(i=begin;i<=end;i++){tmp_sum=tmp_sum+parseFloat(b.getRecordSet().getRecords(0)[i].getData(a))}return tmp_sum=YAHOO.util.Number.format(tmp_sum,{decimalPlaces:c,decimalSeparator:",",thousandsSeparator:" "})};this.td_empty=function(a){newTD=document.createElement("td");newTD.colSpan=a;newTD.style.borderTop="1px solid #000000";newTD.appendChild(document.createTextNode(""));newTR.appendChild(newTD)};this.GetMenuContext=function(c){var b=new Array();var d=0;for(var a=0;a<c[0].permission.length;a++){b[d]=[{text:c[0].permission[a].text}];d++}return b};function substr_count(c,d,e,b){var g=0,a=0;c+="";d+="";if(isNaN(e)){e=0}if(isNaN(b)){b=0}e--;while((e=c.indexOf(d,e+1))!=-1){if(b>0&&(e+d.length)>b){return false}else{a++}}return a}this.html_entity_decode=function(b){var e={},c={},d=0;var a=chr="";e["34"]="quot";e["38"]="amp";e["60"]="lt";e["62"]="gt";e["160"]="nbsp";e["161"]="iexcl";e["162"]="cent";e["163"]="pound";e["164"]="curren";e["165"]="yen";e["166"]="brvbar";e["167"]="sect";e["168"]="uml";e["169"]="copy";e["170"]="ordf";e["171"]="laquo";e["172"]="not";e["173"]="shy";e["174"]="reg";e["175"]="macr";e["176"]="deg";e["177"]="plusmn";e["178"]="sup2";e["179"]="sup3";e["180"]="acute";e["181"]="micro";e["182"]="para";e["183"]="middot";e["184"]="cedil";e["185"]="sup1";e["186"]="ordm";e["187"]="raquo";e["188"]="frac14";e["189"]="frac12";e["190"]="frac34";e["191"]="iquest";e["192"]="Agrave";e["193"]="Aacute";e["194"]="Acirc";e["195"]="Atilde";e["196"]="Auml";e["197"]="Aring";e["198"]="AElig";e["199"]="Ccedil";e["200"]="Egrave";e["201"]="Eacute";e["202"]="Ecirc";e["203"]="Euml";e["204"]="Igrave";e["205"]="Iacute";e["206"]="Icirc";e["207"]="Iuml";e["208"]="ETH";e["209"]="Ntilde";e["210"]="Ograve";e["211"]="Oacute";e["212"]="Ocirc";e["213"]="Otilde";e["214"]="Ouml";e["215"]="times";e["216"]="Oslash";e["217"]="Ugrave";e["218"]="Uacute";e["219"]="Ucirc";e["220"]="Uuml";e["221"]="Yacute";e["222"]="THORN";e["223"]="szlig";e["224"]="agrave";e["225"]="aacute";e["226"]="acirc";e["227"]="atilde";e["228"]="auml";e["229"]="aring";e["230"]="aelig";e["231"]="ccedil";e["232"]="egrave";e["233"]="eacute";e["234"]="ecirc";e["235"]="euml";e["236"]="igrave";e["237"]="iacute";e["238"]="icirc";e["239"]="iuml";e["240"]="eth";e["241"]="ntilde";e["242"]="ograve";e["243"]="oacute";e["244"]="ocirc";e["245"]="otilde";e["246"]="ouml";e["247"]="divide";e["248"]="oslash";e["249"]="ugrave";e["250"]="uacute";e["251"]="ucirc";e["252"]="uuml";e["253"]="yacute";e["254"]="thorn";e["255"]="yuml";for(d in e){a=e[d];c[a]=d}return(b+"").replace(/(\&([a-zA-Z]+)\;)/g,function(l,h,g){if(g in c){return String.fromCharCode(c[g])}else{return g}})};this.onContextMenuClick=function(n,h,e){var g=h[1];var l=datatable.length;if(g){for(y=0;y<l;y++){var c=e.getTrEl(this.contextEventTarget);if(c){var o=e.getRecord(c);if(datatable[y][0].permission!=""){var b=datatable[y][0].permission[g.groupIndex].action;var d="";var a="";if(datatable[y][0].permission[g.groupIndex].parameters!=null){for(f=0;f<datatable[y][0].permission[g.groupIndex].parameters.parameter.length;f++){param_name=datatable[y][0].permission[g.groupIndex].parameters.parameter[f].name;param_source=datatable[y][0].permission[g.groupIndex].parameters.parameter[f].source;if(typeof(datatable[y][0].permission[g.groupIndex].parameters.parameter[f].ready)!="undefined"){a=a+"&"+param_name+"="+param_source}else{a=a+"&"+param_name+"="+o.getData(param_source)}}d=b+a}if(datatable[y][0].permission[g.groupIndex].parameters.parameter.length>0){}else{d=b}d=html_entity_decode(d);if(substr_count(d,"delete")>0){confirm_msg=datatable[y][0].permission[g.groupIndex].confirm_msg;if(confirm(confirm_msg)){d=d+"&confirm=yes&phpgw_return_as=json";delete_record(d,e)}}else{if(substr_count(d,"target=_blank")>0){window.open(d,"_blank")}else{window.open(d,"_self")}}}}}}};this.delete_record=function(sUrl,datatable){var callback={success:function(o){eval("values_ds ="+o.responseText);if(values_ds==""){update_datatable(datatable)}else{eval("values_ds ="+values_ds);update_datatable(datatable)}},failure:function(o){window.alert("Server or your connection is dead.")},timeout:10000};var request=YAHOO.util.Connect.asyncRequest("POST",sUrl,callback)};this.td_sum=function(a){newTD=document.createElement("td");newTD.colSpan=1;newTD.style.borderTop="1px solid #000000";newTD.style.fontWeight="bolder";newTD.style.textAlign="right";newTD.style.paddingRight="0.8em";newTD.appendChild(document.createTextNode(a));newTR.appendChild(newTD)};this.init_datatable=function(data,container,pager,myColumnDefs,num){myDataSource=new YAHOO.util.DataSource(data[0]["values"]);myDataSource.responseType=YAHOO.util.DataSource.TYPE_JSARRAY;fields=new Array();for(i=0;i<myColumnDefs.length;i++){fields[i]=myColumnDefs[i].key}myDataSource.responseSchema={fields:fields};if(data[0]["is_paginator"]==1){myPaginatorConfig={containers:pager,totalRecords:data[0]["total_records"],pageLinks:10,rowsPerPage:10};eval("myPaginator_"+num+" = new YAHOO.widget.Paginator(myPaginatorConfig)");myTableConfig={paginator:eval("myPaginator_"+num)};eval("myDataTable_"+num+" = new YAHOO.widget.DataTable(container, myColumnDefs, myDataSource, myTableConfig)")}else{eval("myDataTable_"+num+" = new YAHOO.widget.DataTable(container, myColumnDefs, myDataSource)")}eval("myDataTable_"+num).subscribe("renderEvent",function(){myParticularRenderEvent(num)});eval("myDataTable_"+num).subscribe("rowMouseoverEvent",eval("myDataTable_"+num).onEventHighlightRow);eval("myDataTable_"+num).subscribe("rowMouseoutEvent",eval("myDataTable_"+num).onEventUnhighlightRow);if(data[0]["permission"]){var myContextMenu=new YAHOO.widget.ContextMenu("mycontextmenu",{trigger:eval("myDataTable_"+num).getTbodyEl()});myContextMenu.addItems(GetMenuContext(data));myContextMenu.render("contextmenu_"+num);myContextMenu.subscribe("click",onContextMenuClick,eval("myDataTable_"+num))}};CreateRowChecked=function(a){newTD=document.createElement("td");newTD.colSpan=1;newTD.style.borderTop="1px solid #000000";myA=document.createElement("A");url='javascript:check_all("'+a+'")';myA.setAttribute("href",url);url="property/templates/portico/images/check.png";myImg=document.createElement("IMG");myImg.setAttribute("src",url);myImg.setAttribute("width","16");myImg.setAttribute("height","16");myImg.setAttribute("border","0");myImg.setAttribute("alt","Select All");myA.appendChild(myImg);mydiv=document.createElement("div");mydiv.setAttribute("align","center");mydiv.appendChild(myA);newTD.appendChild(mydiv);newTR.appendChild(newTD)};this.init_buttons=function(div,j){for(p=0;p<myButtons[j].length;p++){if(myButtons[j][p].type=="buttons"){var config={id:myButtons[j][p].id,type:myButtons[j][p].type,label:myButtons[j][p].label,container:div,value:myButtons[j][p].value};botton_tmp=new YAHOO.widget.Button(config);botton_tmp.on("click",eval(myButtons[j][p].funct));eval("Button_"+j+"_"+p+" = botton_tmp")}else{if(myButtons[j][p].type=="menu"){var config={name:myButtons[j][p].id,type:myButtons[j][p].type,label:myButtons[j][p].label,container:div,menu:myButtons[j][p].value,menumaxheight:300};botton_tmp=new YAHOO.widget.Button(config);eval("Button_"+j+"_"+p+" = botton_tmp")}else{if(myButtons[j][p].type=="inputText"){txt=document.createElement("input");txt.setAttribute("type",myButtons[j][p].type);txt.setAttribute("name",myButtons[j][p].id);txt.setAttribute("id",myButtons[j][p].id);txt.setAttribute("size",myButtons[j][p].size);txt.setAttribute("class",myButtons[j][p].classname);div.appendChild(txt)}else{if(myButtons[j][p].type=="text"){sp=document.createElement("span");sp.className=myButtons[j][p].classname;sp.innerHTML=myButtons[j][p].label;div.appendChild(sp)}}}}if(myButtons[j][p].type=="menu"||myButtons[j][p].type=="buttons"){hd=document.createElement("input");hd.setAttribute("type","hidden");hd.setAttribute("id","hd_"+myButtons[j][p].id);hd.setAttribute("class",myButtons[j][p].classname);hd.setAttribute("name",myButtons[j][p].id);hd.setAttribute("value",myButtons[j][p].value_hidden);div.appendChild(hd)}}};this.update_datatable=function(a){var b=a.getRecordSet().getLength();if(b>0){a.deleteRows(0,b)}for(i=0;i<values_ds.length;i++){a.addRow(values_ds[i])}};this.td_empty=function(a){newTD=document.createElement("td");newTD.colSpan=a;newTD.style.borderTop="1px solid #000000";newTD.appendChild(document.createTextNode(""));newTR.appendChild(newTD)};this.execute_async=function(datatable){try{ds=phpGWLink("index.php",base_java_url,true)}catch(e){alert(e)}var callback={success:function(o){eval("values_ds ="+o.responseText);if(values_ds==""){update_datatable(datatable)}else{eval("values_ds ="+values_ds);update_datatable(datatable)}},failure:function(o){window.alert("Server or your connection is dead.")},timeout:10000,cache:false};try{YAHOO.util.Connect.asyncRequest("POST",ds,callback)}catch(e_async){alert(e_async.message)}};this.deletes_quotes=function(array,field){if((typeof(array)!="undefined")&&(typeof(array[field])!="undefined")){field_quotes=array[field];array[field]=eval(field_quotes)}};for(i=0;i<myColumnDefs.length;i++){for(j=0;j<myColumnDefs[i].length;j++){this.deletes_quotes(myColumnDefs[i][j],"formatter")}}if(typeof(myButtons)!="undefined"){for(k=0;k<myButtons.length;k++){for(m=0;m<myButtons[k].length;m++){if(myButtons[k][m]["type"]=="menu"){for(p=0;p<myButtons[k][m]["value"].length;p++){try{this.deletes_quotes(myButtons[k][m]["value"][p]["onclick"],"fn")}catch(err){txt="There was an error on this page.\n\n";txt+="Error description: "+err.description+"\n\n";alert(txt)}}}}}}for(j=0;j<datatable.length;j++){if(YAHOO.util.Dom.inDocument("datatable-container_"+j)){pager=YAHOO.util.Dom.get("paging_"+j);div=YAHOO.util.Dom.get("datatable-container_"+j);this.init_datatable(datatable[j],div,pager,myColumnDefs[j],j)}}if(typeof(myButtons)!="undefined"){for(j=0;j<myButtons.length;j++){if(YAHOO.util.Dom.inDocument("datatable-buttons_"+j)){div=YAHOO.util.Dom.get("datatable-buttons_"+j);this.init_buttons(div,j)}}};